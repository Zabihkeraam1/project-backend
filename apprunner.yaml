version: 1.0
runtime: python311

build:
  commands:
    pre-build:
      - echo "âœ… Pre-build step started"
    build:
      - mkdir -p /app
      - cp -r ./backend/* /app
      - pip3 install --upgrade pip
      - pip3 install uvicorn fastapi
      - pip3 install -r /app/requirements.txt
    post-build:
      - echo "âœ… Post-build step complete"
run:
  runtime-version: 3
  command: |
     echo "=== INSTALLED PACKAGES ==="
     python3 -m pip3 list --format=columns
     python3 -m uvicorn backend.main:app --host 0.0.0.0 --port 8080
  network:
    port: 8080


# version: 1.0
# runtime: python311

# build:
#   commands:
#     pre-build:
#       - echo "ðŸš€ Starting build process..."
#     build:
#       - mkdir -p /app/.python-packages
#       - cp -r ./backend/* /app
#       - pip3 install --upgrade pip
#       - pip3 install --target=/usr/local/lib/python3.11/site-packages uvicorn fastapi
#       - pip3 install --target=/usr/local/lib/python3.11/site-packages -r /app/requirements.txt
#       # Verification
#       - python3 -c "import uvicorn; print(f'âœ… Uvicorn {uvicorn.__version__} verified')"
#     post-build:
#       - echo "ðŸ“¦ Build completed successfully"

# run:
#   command: python3 -m uvicorn backend.main:app --host 0.0.0.0 --port 8080
#   network:
#     port: 8080

# version: 1.0
# runtime: python311

# build:
#   commands:
#     pre-build:
#       - echo "ðŸš€ Starting build process..."
#     build:
#       # Install to both system and app directory (dual protection)
#       - python3.11 -m pip install --upgrade pip
#       - python3.11 -m pip install --system uvicorn fastapi
#       - python3.11 -m pip install --system -r ./backend/requirements.txt
#       # Additional install to /app as backup
#       - mkdir -p /app/.python-packages
#       - python3.11 -m pip install --target=/app/.python-packages uvicorn fastapi
#       - python3.11 -m pip install --target=/app/.python-packages -r ./backend/requirements.txt
#       # Verification
#       - python3.11 -c "import uvicorn; print(f'âœ… System Uvicorn at {uvicorn.__file__}')"
#       - PYTHONPATH=/app/.python-packages python3.11 -c "import uvicorn; print(f'âœ… Local Uvicorn at {uvicorn.__file__}')"
#     post-build:
#       - echo "ðŸ“¦ Build completed successfully"

# run:
#   command: |
#     echo "=== PYTHONPATH ==="
#     python3.11 -c "import sys; print(sys.path)"
#     echo "=== STARTING APP ==="
#     python3.11 -m uvicorn backend.main:app --host 0.0.0.0 --port 8080
#   network:
#     port: 8080
